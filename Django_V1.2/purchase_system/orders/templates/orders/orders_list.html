{% extends "base.html" %}
{% block title %}Order List{% endblock %}

{% block content %}  
<h2>Order List</h2>
<div class="container">
    <a href="{% url 'order_new' %}" class="btn btn-green">Add New Order</a>
<br>
<br>

    <form method="get" class="search-form">
        <div class="form-row">
            <div class="form-col">
                <label for="employee_name">Employee Name:</label>
                <input type="text" id="employee_name" name="employee_name" placeholder="Search by employee name...">
            </div>
            <div class="form-col">
                <label for="order_code">Order Code:</label>
                <input type="text" id="order_code" name="order_code" placeholder="Search by order code...">
            </div>
            <div class="form-col">
                <label for="product_name">Product Name:</label>
                <input type="text" id="product_name" name="product_name" placeholder="Search by product name...">
            </div>
        </div>
        <div class="form-row">
            <div class="form-col">
                <label for="date_from">Date From:</label>
                <input type="date" id="date_from" name="date_from">
            </div>
            <div class="form-col">
                <label for="date_to">Date To:</label>
                <input type="date" id="date_to" name="date_to">
            </div>
            <div class="form-col">
                <label for="supplier_name">Supplier Name:</label>
                <input type="text" id="supplier_name" name="supplier_name" placeholder="Search by supplier name...">
            </div>
        </div>
        <button type="submit" class="search-button" style="position:relative; left:5px">Search</button>
    </form>
    <ul style="list-style-type: none; padding: 0;">
        {% for order in orders %}
        <li style="margin-bottom: 20px; padding: 10px; border: 1px solid #fcccbc; border-radius: 0px;">
            <strong>Order number {{ order.id }}:</strong> {{ order.product_name }} - Quantity: {{ order.quantity }}
            <ul style="list-style-type: none; padding-left: 20px;">
                <li style="color: #4f4f4f;"><strong>Product code:</strong> {{ order.product_code }}</li>
                <li style="color: #4f4f4f;"><strong>Order Name:</strong> {{ order.order_name }}</li>
                <li style="color: #4f4f4f;"><strong>Supplier:</strong> {{ order.product.supplier }}</li>
                <li style="color: #4f4f4f;"><strong>Status:</strong> {{ order.status }}</li>
                <li style="color: #4f4f4f;"><strong>Order Date:</strong> {{ order.order_date }}</li>
                <li style="color: #4f4f4f;"><strong>Due Date:</strong> {{ order.due_date|default:"None" }}</li>
                <li style="color: #4f4f4f;"><strong>Project Name:</strong> {{ order.project_name }}</li>
                <li style="color: #4f4f4f;"><strong>Project Code:</strong> {{ order.project_code }}</li>
                <li style="color: #4f4f4f;"><strong>Project Phase:</strong> {{ order.project_phase }}</li>
                <li style="color: #4f4f4f;"><strong>Project Consultant:</strong> {{ order.project_consultant }}</li>
                <li style="color: #4f4f4f;"><strong>Project Location:</strong> {{ order.project_location }}</li>
                {% if order.product.image %}
                    <li><img src="{{ order.product.image.url }}" alt="Product Image" style="max-width: 100px; max-height: 100px;"></li>
                {% endif %}
            </ul>
            <br>
            <a href="{% url 'order_edit' id=order.id %}" class="btn btn-white">Edit</a>
            <a href="javascript:void(0);" class="btn btn-red" onclick="showModal({{ order.id }})">Delete</a>
            {% if order.status == 'pending' %}
                <a href="{% url 'order_approve' id=order.id %}" class="btn btn-green">Approve</a>
                <a href="{% url 'order_disapprove' id=order.id %}" class="btn btn-red">Disapprove</a>
            {% endif %}
        </li>
        {% endfor %}
    </ul>
</div>

<div id="deleteModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Delete Order</h2>
        <p>Are you sure you want to delete order number "<span id="order-id"></span>"?</p>
        <form method="post" action="{% url 'order_delete' id='0' %}" id="deleteForm">
            {% csrf_token %}
            <button type="submit" class="btn btn-red">Delete</button>
            <button type="button" class="btn btn-white">Close</button>
        </form>
    </div>
</div>

<style>
    .modal {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1; /* Sit on top */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    }

    .modal-content {
        background-color: #fefefe;
        margin: 15% auto; /* 15% from the top and centered */
        padding: 20px;
        border: 1px solid #888;
        width: 80%; /* Could be more or less, depending on screen size */
    }

    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

    .close:hover,
    .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }
</style>

<script>
function showModal(orderId) {
    var modal = document.getElementById('deleteModal');
    var span = document.getElementsByClassName("close")[0];
    var form = document.getElementById('deleteForm');

    document.getElementById('order-id').textContent = orderId;
    form.action = '{% url "order_delete" id='0' %}'.replace('0', orderId);

    modal.style.display = "block";

    span.onclick = function() {
        modal.style.display = "none";
    }

    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
}
</script>
{% endblock %}