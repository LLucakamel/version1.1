{% extends "base.html" %}
{% block title %}Add New Order{% endblock %}

{% block content %}
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>

    <h2>{{ form.instance.id|yesno:"Edit,Add New" }} Order</h2>
    <div class="container">
        <form method="post" id="orderForm">
            {% csrf_token %}
            {{ form.non_field_errors }}
            <div class="form-row">
                <!-- First Row: Product Name, Product Code, Quantity, Order Name -->
                <div class="form-col">{{ form.product_name.label_tag }}{{ form.product_name }}</div>
                <div class="form-col">{{ form.product_code.label_tag }}{{ form.product_code }}</div>
                <div class="form-col">{{ form.quantity.label_tag }}{{ form.quantity }}</div>
                <div class="form-col">{{ form.order_name.label_tag }}{{ form.order_name }}</div>
            </div>
            <div class="form-row">
                <!-- Second Row: Due to Date -->
                <div class="form-col">{{ form.due_date.label_tag }}{{ form.due_date }}</div>
            </div>
            <div class="form-row">
                <!-- Third Row: Project Name, Project Code, Project Consultant, Project Location -->
                <div class="form-col">{{ form.project_name.label_tag }}{{ form.project_name }}</div>
                <div class="form-col">{{ form.project_code.label_tag }}{{ form.project_code }}</div>
                <div class="form-col">{{ form.project_consultant.label_tag }}{{ form.project_consultant }}</div>
                <div class="form-col">{{ form.project_location.label_tag }}{{ form.project_location }}</div>
            </div>
            <div class="form-row">
                <!-- Fourth Row: Project Phase -->
                <div class="form-col">
                    {{ form.project_phase.label_tag }}
                    <select name="{{ form.project_phase.name }}" id="{{ form.project_phase.id_for_label }}">
                        <option value="">---</option>
                        {% for num in range_1_to_10 %}
                            <option value="{{ num }}" {% if form.project_phase.value|stringformat:"s" == num|stringformat:"s" %}selected{% endif %}>{{ num }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="form-row">
                <!-- Supplier -->
                <div class="form-col">
                    <label for="id_supplier">Supplier:</label>
                    <input type="text" name="supplier" id="id_supplier" placeholder="Enter supplier name">
                </div>
            </div>
            <button type="submit" class="btn btn-orange">Save</button>
           
        </form> <br>
        <a href="{% url 'order_list' %}" class="btn btn-red">Return to Order List</a>
    </div>

    <script>
    $(function() {
        function setupAutocomplete(elementId, otherElementId) {
            $(elementId).autocomplete({
                source: function(request, response) {
                    console.log("Searching for:", request.term);
                    $.ajax({
                        url: "{% url 'product_search' %}",
                        dataType: "json",
                        data: {
                            term: request.term,
                            field: elementId === "#id_product_name" ? "name" : "code"
                        },
                        success: function(data) {
                            console.log("Received data:", data);
                            response(data);
                        },
                        error: function(xhr, status, error) {
                            console.error("Error:", error);
                        }
                    });
                },
                minLength: 2,
                select: function(event, ui) {
                    $("#id_product_name").val(ui.item.name);
                    $("#id_product_code").val(ui.item.code);
                    return false;
                }
            });
        }

        setupAutocomplete("#id_product_name", "#id_product_code");
        setupAutocomplete("#id_product_code", "#id_product_name");
    });
    </script>
{% endblock %}